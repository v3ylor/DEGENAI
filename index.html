<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$DEGENAGENT | WAR_ROOM</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* --- CORE SYSTEM --- */
        :root {
            --neon-green: #00ff41;
            --neon-dark: #003b00;
            --bg-color: #020202;
            --panel-bg: rgba(0, 10, 0, 0.65);
            --border-color: rgba(0, 255, 65, 0.3);
            --font-mono: 'Courier New', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--neon-green);
            font-family: var(--font-mono);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- 3D CANVAS LAYER --- */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }

        /* --- CRT & SCANLINE OVERLAY --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 99; opacity: 0.6;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.8) 100%);
            pointer-events: none; z-index: 98;
        }

        /* --- LAYOUT --- */
        .app-container {
            display: grid;
            grid-template-rows: 60px 1fr 30px;
            height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
            width: 100%;
            padding: 10px;
            gap: 10px;
            z-index: 10;
        }

        /* --- HUD DECORATIONS (The "Complex" Look) --- */
        .hud-corner {
            position: absolute; width: 20px; height: 20px;
            border-color: var(--neon-green); border-style: solid;
            pointer-events: none;
        }
        .tl { top: 0; left: 0; border-width: 2px 0 0 2px; }
        .tr { top: 0; right: 0; border-width: 2px 2px 0 0; }
        .bl { bottom: 0; left: 0; border-width: 0 0 2px 2px; }
        .br { bottom: 0; right: 0; border-width: 0 2px 2px 0; }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            background: rgba(0,0,0,0.8);
            padding: 0 20px;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neon-green);
        }

        .nav-tabs { display: flex; gap: 1px; background: var(--border-color); }
        .tab {
            background: #000;
            padding: 8px 30px;
            cursor: pointer;
            color: #555;
            transition: 0.2s;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        .tab:hover { color: #fff; background: #111; }
        .tab.active { color: var(--neon-green); background: #051505; font-weight: bold; border-top: 2px solid var(--neon-green); }

        /* --- MAIN CONTENT --- */
        main { position: relative; overflow: hidden; display: flex; }
        
        .page { display: none; width: 100%; height: 100%; padding: 20px; animation: glitchFade 0.2s ease-out; }
        .page.active { display: block; }
        @keyframes glitchFade { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* --- DASHBOARD LAYOUT --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr 350px; /* 3 Columns for Complexity */
            gap: 15px;
            height: 100%;
        }

        /* --- PANELS --- */
        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            position: relative;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(4px);
        }
        .panel-header {
            background: rgba(0, 255, 65, 0.1);
            padding: 5px 10px;
            font-size: 0.7rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            letter-spacing: 1px;
        }

        /* --- HERO TEXT --- */
        .hero-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        h1 { font-size: 4rem; text-shadow: 0 0 20px var(--neon-green); margin-bottom: 20px; line-height: 0.9; }
        .glitch-text { animation: glitch 2s infinite; }

        /* --- TICKER FEED --- */
        #ticker-feed { overflow-y: auto; flex-grow: 1; padding: 10px; font-size: 0.8rem; }
        .ticker-item {
            display: flex; justify-content: space-between;
            padding: 4px 0; border-bottom: 1px solid rgba(0, 255, 65, 0.1);
        }

        /* --- TERMINAL --- */
        #cli-output {
            flex-grow: 1; padding: 15px; overflow-y: auto; color: #ccc;
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .input-line { display: flex; border-top: 1px solid var(--border-color); padding: 10px; background: rgba(0,0,0,0.8); }
        #cli-input { background: transparent; border: none; color: var(--neon-green); width: 100%; outline: none; font-family: inherit; font-size: 1rem; }

        /* --- FOOTER --- */
        footer {
            border-top: 1px solid var(--border-color);
            background: #000;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; font-size: 0.7rem; color: #666;
        }

        /* --- BUTTONS --- */
        .btn {
            background: var(--neon-green); color: #000; border: none;
            padding: 10px 20px; font-weight: bold; cursor: pointer;
            text-transform: uppercase; margin-top: 20px;
            box-shadow: 0 0 15px var(--neon-green);
        }
        .btn:hover { background: #fff; box-shadow: 0 0 25px #fff; }

        /* --- ANIMATIONS --- */
        @keyframes glitch { 
            0% { transform: translate(0) } 
            20% { transform: translate(-2px, 2px) } 
            40% { transform: translate(-2px, -2px) } 
            60% { transform: translate(2px, 2px) } 
            80% { transform: translate(2px, -2px) } 
            100% { transform: translate(0) }
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--neon-green); }

    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div class="app-container">
        <header>
            <div class="brand">Protocol_v4 <span style="font-size:0.5em; opacity:0.5;">// CLASSIFIED</span></div>
            <div class="nav-tabs">
                <div class="tab active" onclick="switchPage('home')">Command_Center</div>
                <div class="tab" onclick="switchPage('train')">Neural_Net</div>
                <div class="tab" onclick="switchPage('data')">Chain_Data</div>
                <div class="tab" onclick="switchPage('lore')">Manifesto</div>
            </div>
            <div id="sys-time">00:00:00 UTC</div>
        </header>

        <main>
            <div id="home" class="page active">
                <div class="dashboard-grid">
                    
                    <div class="panel">
                        <div class="hud-corner tl"></div><div class="hud-corner tr"></div>
                        <div class="panel-header"><span>SYSTEM_STATUS</span><span>[AUTO]</span></div>
                        <div style="padding: 20px;">
                            <div style="margin-bottom:15px; color:#aaa; font-size:0.8rem;">
                                MODEL: GEMINI-2.5-FLASH<br>
                                LATENCY: 12ms<br>
                                UPTIME: 99.99%<br>
                                SENTIMENT: <span class="glitch-text" style="color:var(--neon-green)">EXTREME GREED</span>
                            </div>
                            <hr style="border-color:var(--border-color); opacity:0.3;">
                            <div style="margin-top:15px;">
                                <div style="font-size:0.7rem; color:#555;">ACTIVE AGENTS</div>
                                <div style="font-size:2rem; font-weight:bold;">4,092</div>
                            </div>
                        </div>
                        <div class="hud-corner bl"></div><div class="hud-corner br"></div>
                    </div>

                    <div class="hero-center">
                        <h1 class="glitch-text">HUMAN<br>OBSOLETE</h1>
                        <div style="background:#000; border:1px solid var(--neon-green); padding:10px 20px; display:inline-block;">
                            <span style="color:#fff">CA:</span> 888xGENESIS...DEGEN...101
                        </div>
                        <button class="btn" onclick="switchPage('train')">INITIALIZE TERMINAL</button>
                    </div>

                    <div class="panel">
                        <div class="panel-header"><span>MEMPOOL_FEED</span><span>SOLANA</span></div>
                        <div id="ticker-feed">
                            </div>
                    </div>

                </div>
            </div>

            <div id="train" class="page">
                <div class="panel" style="height:100%;">
                    <div class="panel-header"><span>NEURAL_UPLINK</span><span>SECURE</span></div>
                    <div id="cli-output">
                        <div>> SYSTEM BOOT SEQUENCE INITIATED...</div>
                        <div style="color:var(--neon-green)">> GEMINI KERNEL LOADED.</div>
                        <br>
                        <div>> "The market is a device for transferring money from the impatient to the patient."</div>
                        <div>> Waiting for directive...</div>
                    </div>
                    <div class="input-line">
                        <span style="margin-right:10px;">root@degen:~$</span>
                        <input type="text" id="cli-input" placeholder="Enter strategy prompt...">
                    </div>
                </div>
            </div>
            
            <div id="data" class="page">
                <div class="panel" style="padding:40px; text-align:center;">
                    <h2>TOKEN_METRICS</h2>
                    <br>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px;">
                        <div style="border:1px solid #333; padding:20px;">
                            <div style="font-size:3rem;">1B</div>
                            <div style="font-size:0.8rem; color:#888;">SUPPLY</div>
                        </div>
                        <div style="border:1px solid #333; padding:20px;">
                            <div style="font-size:3rem; color:var(--neon-green);">0%</div>
                            <div style="font-size:0.8rem; color:#888;">TAX</div>
                        </div>
                        <div style="border:1px solid #333; padding:20px;">
                            <div style="font-size:3rem; color:red;">BURN</div>
                            <div style="font-size:0.8rem; color:#888;">LIQUIDITY</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="lore" class="page">
                <div class="panel" style="padding:40px; max-width:800px; margin:0 auto;">
                    <h2 style="color:red">THE MANIFESTO</h2>
                    <p style="margin-top:20px; line-height:1.6; color:#ccc;">
                        We are not here to take part. We are here to take over.
                        <br><br>
                        The era of human trading is over. Emotional damage, fatigue, fomoâ€”these are biological weaknesses.
                        Protocol_v4 removes the weak link (you) and replaces it with cold, hard, calculating silicon.
                    </p>
                </div>
            </div>

        </main>

        <footer>
            <div>MEM: 64TB</div>
            <div>NET: <span style="color:var(--neon-green)">CONNECTED</span></div>
            <div>BUILD: v4.0.0_ALPHA</div>
        </footer>
    </div>

    <script>
        /* --- 3D ENGINE (THE COMPLEX PART) --- */
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // 1. The Torus Knot (The Brain)
        const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const material = new THREE.PointsMaterial({ 
            color: 0x00ff41, 
            size: 0.15,
            transparent: true,
            opacity: 0.6
        });
        const torus = new THREE.Points(geometry, material);
        scene.add(torus);

        // 2. The Grid Floor (The Market)
        const gridHelper = new THREE.GridHelper(200, 50, 0x003300, 0x001100);
        gridHelper.position.y = -15;
        scene.add(gridHelper);

        // 3. Floating Data Particles
        const partGeo = new THREE.BufferGeometry();
        const partCount = 2000; // Dense
        const posArray = new Float32Array(partCount * 3);
        for(let i=0; i<partCount*3; i++) {
            posArray[i] = (Math.random() - 0.5) * 100;
        }
        partGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const partMat = new THREE.PointsMaterial({ size: 0.1, color: 0x005500 });
        const particles = new THREE.Points(partGeo, partMat);
        scene.add(particles);

        camera.position.z = 30;

        // Animation Loop
        let mouseX = 0;
        let mouseY = 0;

        function animate() {
            requestAnimationFrame(animate);

            // Rotate Torus (Complex motion)
            torus.rotation.x += 0.003;
            torus.rotation.y += 0.005;
            
            // Move Particles
            particles.rotation.y -= 0.001;

            // Move Grid to simulate speed
            gridHelper.position.z += 0.05;
            if(gridHelper.position.z > 5) gridHelper.position.z = 0;

            // Interactive Camera
            camera.position.x += (mouseX - camera.position.x) * 0.05;
            camera.position.y += (-mouseY - camera.position.y) * 0.05;
            camera.lookAt(scene.position);

            renderer.render(scene, camera);
        }

        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth / 2) / 50; // More sensitive
            mouseY = (e.clientY - window.innerHeight / 2) / 50;
        });
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

        /* --- UI LOGIC --- */
        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        setInterval(() => {
            document.getElementById('sys-time').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC";
        }, 1000);

        /* --- TICKER FEED --- */
        const ticker = document.getElementById('ticker-feed');
        const CA = "Dt7rNPRfpmf4P8QvWQgyh5S7pnp4nQWYUmUwrarwpump"; 
        let knownSig = new Set();

        async function startFeed() {
            try {
                const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${CA}`);
                const data = await res.json();
                if(data.pairs) fetchTrades(data.pairs[0].pairAddress);
                setInterval(() => { if(data.pairs) fetchTrades(data.pairs[0].pairAddress); }, 5000);
            } catch(e) {}
        }

        async function fetchTrades(pool) {
            try {
                const res = await fetch(`https://api.geckoterminal.com/api/v2/networks/solana/pools/${pool}/trades`);
                const json = await res.json();
                json.data.reverse().forEach(t => {
                    const attr = t.attributes;
                    if(!knownSig.has(attr.tx_hash)) {
                        knownSig.add(attr.tx_hash);
                        if(knownSig.size > 200) knownSig.clear();
                        
                        const isBuy = attr.kind === "buy";
                        const div = document.createElement('div');
                        div.className = 'ticker-item';
                        div.innerHTML = `
                            <span style="color:${isBuy ? '#0f0' : '#f00'}">${isBuy ? 'BUY' : 'SELL'}</span>
                            <span>$${parseFloat(attr.volume_in_usd).toFixed(2)}</span>
                        `;
                        ticker.prepend(div);
                    }
                });
            } catch(e) {}
        }
        startFeed();

        /* --- TERMINAL LOGIC --- */
        const cliInput = document.getElementById('cli-input');
        const cliOutput = document.getElementById('cli-output');

        cliInput.addEventListener('keypress', async (e) => {
            if(e.key === 'Enter') {
                const cmd = cliInput.value;
                cliInput.value = '';
                addLog(`root@degen:~$ ${cmd}`, '#fff');
                addLog(`> PROCESSING...`, '#555');
                
                try {
                    const res = await fetch('/api/brain', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: cmd })
                    });
                    const data = await res.json();
                    setTimeout(() => {
                        addLog(`[AI]: ${data.message}`, data.action === "BUY" ? "#0f0" : "#f00");
                    }, 500);
                } catch(err) { addLog(`ERROR: OFFLINE`, 'red'); }
            }
        });

        function addLog(text, color) {
            const d = document.createElement('div');
            d.style.color = color;
            d.innerText = text;
            cliOutput.appendChild(d);
            cliOutput.scrollTop = cliOutput.scrollHeight;
        }
    </script>
</body>
</html>
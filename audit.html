<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEGEN_AI // GMGN_SECURITY_PROTOCOL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --neon-green: #00ff41;
            --neon-red: #ff003c;
            --neon-yellow: #fcee0a;
            --neon-blue: #0088ff;
            --bg: #000000;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'Rajdhani', sans-serif; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        #webgl { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 10; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 30px 50px; pointer-events: auto;
        }
        .brand { font-family: 'Share Tech Mono', monospace; font-size: 1.5rem; letter-spacing: 2px; color: var(--neon-green); }
        .nav a { color: #666; text-decoration: none; margin-left: 30px; font-weight: bold; font-size: 1rem; transition: 0.3s; }
        .nav a:hover, .nav a.active { color: #fff; text-shadow: 0 0 10px #fff; }

        /* INPUT */
        .center-stage {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100%; max-width: 600px; text-align: center;
            pointer-events: auto; z-index: 20;
        }

        .input-wrapper {
            position: relative;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 5px;
            border-radius: 50px;
            display: flex; align-items: center;
            transition: 0.5s; transform: scale(0.9); opacity: 0;
            animation: floatUp 1s 0.5s forwards ease-out;
        }
        .input-wrapper:focus-within { border-color: var(--neon-green); box-shadow: 0 0 30px rgba(0,255,65,0.2); transform: scale(1); }

        input {
            background: transparent; border: none; color: #fff;
            font-family: 'Share Tech Mono'; font-size: 1.2rem;
            width: 100%; padding: 15px 25px; outline: none;
            text-transform: uppercase;
        }

        .scan-btn {
            background: #fff; color: #000; border: none;
            padding: 12px 30px; border-radius: 40px;
            font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.3s;
        }
        .scan-btn:hover { background: var(--neon-green); box-shadow: 0 0 20px var(--neon-green); }

        /* GMGN HUD GRID */
        .hud-panel {
            position: absolute; background: rgba(5,5,5,0.95);
            border: 1px solid #333; backdrop-filter: blur(10px);
            padding: 15px; width: 220px;
            pointer-events: auto; opacity: 0; transition: 0.5s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        
        .hud-title { font-size: 0.7rem; color: #888; letter-spacing: 2px; margin-bottom: 5px; font-family: 'Share Tech Mono'; }
        .hud-val { font-size: 1.2rem; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .hud-sub { font-size: 0.65rem; color: #666; margin-top: 3px; text-transform: uppercase; }

        /* LAYOUT */
        #hud-mint { top: 30%; left: 5%; border-left: 2px solid var(--neon-green); }
        #hud-freeze { top: 50%; left: 5%; border-left: 2px solid var(--neon-green); }
        #hud-burn { top: 30%; right: 5%; text-align: right; border-right: 2px solid var(--neon-green); }
        #hud-top10 { top: 50%; right: 5%; text-align: right; border-right: 2px solid var(--neon-green); }

        /* TARGET DISPLAY (CENTER TOP) */
        #hud-target {
            top: 15%; left: 50%; transform: translateX(-50%);
            width: auto; min-width: 300px; text-align: center;
            border: 1px solid var(--neon-green);
            background: rgba(0, 20, 0, 0.9);
        }
        .target-symbol { font-size: 1.5rem; font-weight: 900; letter-spacing: 3px; color: var(--neon-green); }
        .target-ca { font-family: 'Share Tech Mono'; font-size: 0.8rem; color: #aaa; margin-top: 5px; cursor: pointer; transition: 0.3s; }
        .target-ca:hover { color: #fff; text-decoration: underline; }

        /* CENTER VERDICT */
        #hud-verdict { 
            bottom: 25%; left: 50%; transform: translateX(-50%); 
            text-align: center; width: auto; 
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #333;
            padding: 20px 40px;
            backdrop-filter: blur(10px);
            z-index: 25;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        
        #verdict-text { 
            font-size: 3.5rem; font-weight: 900; letter-spacing: 5px; text-transform: uppercase; 
            text-shadow: 3px 3px 0px #000, 0 0 20px currentColor; 
        }
        
        #score-sub { font-family: 'Share Tech Mono'; font-size: 1rem; margin-top: 10px; letter-spacing: 3px; color: #fff; }

        /* RESET BUTTON */
        #reset-btn {
            position: absolute; bottom: 12%; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); border: 1px solid #fff; color: #fff;
            padding: 12px 40px; font-family: 'Share Tech Mono'; cursor: pointer;
            pointer-events: auto; opacity: 0; transition: 0.3s;
            z-index: 30; letter-spacing: 2px; backdrop-filter: blur(5px);
        }
        #reset-btn:hover { background: #fff; color: #000; box-shadow: 0 0 20px #fff; }

        /* HISTORY */
        #history-toggle {
            position: absolute; top: 100px; right: 0;
            background: rgba(255,255,255,0.1); color: var(--neon-green);
            padding: 10px 15px 10px 10px; border-radius: 20px 0 0 20px;
            cursor: pointer; pointer-events: auto;
            border: 1px solid var(--neon-green); border-right: none;
            transition: 0.3s; writing-mode: vertical-rl; text-orientation: mixed;
            font-family: 'Share Tech Mono'; font-size: 0.8rem; letter-spacing: 3px;
        }
        #history-toggle:hover { background: var(--neon-green); color: #000; padding-right: 25px; }

        #history-panel {
            position: absolute; top: 0; right: -320px; width: 300px; height: 100%;
            background: rgba(5, 5, 5, 0.95); border-left: 1px solid #333;
            backdrop-filter: blur(15px); padding: 80px 20px 20px 20px;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto; z-index: 15; display: flex; flex-direction: column;
        }
        #history-panel.open { right: 0; }

        .hist-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; transition: 0.2s; position: relative; }
        .hist-item:hover { background: rgba(255,255,255,0.05); padding-left: 20px; }
        .hist-ca { font-size: 0.7rem; color: #888; font-family: 'Share Tech Mono'; }
        .hist-verdict { font-size: 0.9rem; font-weight: bold; margin-top: 5px; }
        .hist-score { position: absolute; top: 15px; right: 10px; font-size: 1.2rem; font-weight: 900; }

        #loading-text {
            position: absolute; top: 60%; left: 50%; transform: translate(-50%, 0);
            font-family: 'Share Tech Mono'; color: var(--neon-green); letter-spacing: 2px;
            display: none; width: 100%; text-align: center;
        }

        @keyframes floatUp { to { opacity: 1; transform: scale(1); } }
        
        .footer { padding: 20px 50px; display: flex; justify-content: space-between; font-size: 0.8rem; color: #444; font-family: 'Share Tech Mono'; }
    </style>
</head>
<body>

    <canvas id="webgl"></canvas>

    <div id="ui-layer">
        <header>
            <div class="brand">DEGEN_AI // GMGN_CORE</div>
            <div class="nav">
                <a href="index.html">CMD</a>
                <a href="terminal.html">TERM</a>
                <a href="data.html">DATA</a>
                <a href="audit.html" class="active">AUDIT</a>
            </div>
        </header>

        <div class="center-stage" id="input-section">
            <h1 style="margin-bottom:20px; font-weight:300; letter-spacing:3px;">TOKEN SECURITY SCAN</h1>
            <div class="input-wrapper">
                <input type="text" id="ca-input" placeholder="PASTE CA HERE...">
                <button class="scan-btn" onclick="runGMGNScan()">SCAN</button>
            </div>
        </div>

        <div id="loading-text">CHECKING MINT AUTHORITY...</div>

        <div id="hud-target" class="hud-panel">
            <div class="hud-title">TARGET LOCKED</div>
            <div class="target-symbol" id="val-symbol">---</div>
            <div class="target-ca" id="val-ca" onclick="copyCA()">---</div>
        </div>

        <div id="hud-mint" class="hud-panel">
            <div class="hud-title">MINT AUTHORITY</div>
            <div class="hud-val" id="val-mint">---</div>
            <div class="hud-sub">CAN DEV PRINT TOKENS?</div>
        </div>
        <div id="hud-freeze" class="hud-panel">
            <div class="hud-title">FREEZE AUTHORITY</div>
            <div class="hud-val" id="val-freeze">---</div>
            <div class="hud-sub">BLACKLIST RISK</div>
        </div>

        <div id="hud-burn" class="hud-panel">
            <div class="hud-title">LP BURNED</div>
            <div class="hud-val" id="val-burn">---</div>
            <div class="hud-sub">LIQUIDITY STATUS</div>
        </div>
        <div id="hud-top10" class="hud-panel">
            <div class="hud-title">TOP 10 HOLDERS</div>
            <div class="hud-val" id="val-top10">---</div>
            <div class="hud-sub">SUPPLY CONCENTRATION</div>
        </div>

        <div id="hud-verdict" class="hud-panel">
            <div id="verdict-text">---</div>
            <div id="score-sub">TRUST SCORE: 0/100</div>
        </div>

        <button id="reset-btn" onclick="resetScanner()">SCAN NEW TARGET</button>

        <div id="history-toggle" onclick="toggleHistory()">SCAN ARCHIVE</div>
        <div id="history-panel">
            <h3 style="font-family:'Share Tech Mono'; color:#666; margin-bottom:20px; letter-spacing:2px;">PREVIOUS SCANS</h3>
            <div id="history-list" style="overflow-y:auto; flex:1;"></div>
            <button onclick="clearHistory()" style="margin-top:20px; background:none; border:1px solid #333; color:#555; padding:10px; cursor:pointer;">CLEAR LOGS</button>
        </div>

        <div class="footer">
            <div>SYSTEM: ONLINE</div>
            <div>MODE: GMGN PROTOCOLS</div>
        </div>
    </div>

    <script id="vertexShader" type="x-shader/x-vertex">
        uniform float time;
        uniform float spike;
        varying vec2 vUv;
        varying vec3 vNormal;
        
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            vec3 i  = floor(v + dot(v, C.yyy) );
            vec3 x0 = v - i + dot(i, C.xxx) ;
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min( g.xyz, l.zxy );
            vec3 i2 = max( g.xyz, l.zxy );
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            i = mod289(i);
            vec4 p = permute( permute( permute( i.z + vec4(0.0, i1.z, i2.z, 1.0 )) + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
            float n_ = 0.142857142857;
            vec3  ns = n_ * D.wyz - D.xzx;
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_ );
            vec4 x = x_ *ns.x + ns.yyyy;
            vec4 y = y_ *ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            vec4 b0 = vec4( x.xy, y.xy );
            vec4 b1 = vec4( x.zw, y.zw );
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
            vec3 p0 = vec3(a0.xy,h.x);
            vec3 p1 = vec3(a0.zw,h.y);
            vec3 p2 = vec3(a1.xy,h.z);
            vec3 p3 = vec3(a1.zw,h.w);
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
            p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );
        }

        void main() {
            vUv = uv;
            vNormal = normal;
            float noise = snoise(position * 2.0 + time * 0.5);
            vec3 newPos = position + normal * noise * spike;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(newPos, 1.0);
        }
    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">
        uniform vec3 color;
        varying vec3 vNormal;
        void main() {
            vec3 viewDir = vec3(0.0, 0.0, 1.0);
            float fresnel = pow(1.0 - dot(vNormal, viewDir), 2.0);
            vec3 glow = color * fresnel * 2.5;
            vec3 base = color * 0.2;
            gl_FragColor = vec4(base + glow, 1.0);
        }
    </script>

    <script>
        /* --- 3D ENGINE --- */
        const canvas = document.querySelector('#webgl');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        const geometry = new THREE.IcosahedronGeometry(2, 64);
        const material = new THREE.ShaderMaterial({
            vertexShader: document.getElementById('vertexShader').textContent,
            fragmentShader: document.getElementById('fragmentShader').textContent,
            uniforms: {
                time: { value: 0.0 },
                spike: { value: 0.1 },
                color: { value: new THREE.Color(0.2, 0.2, 0.2) }
            },
            wireframe: true,
            transparent: true
        });

        const core = new THREE.Mesh(geometry, material);
        scene.add(core);

        const pGeo = new THREE.BufferGeometry();
        const pCount = 1000;
        const pPos = new Float32Array(pCount * 3);
        for(let i=0; i<pCount*3; i++) pPos[i] = (Math.random() - 0.5) * 20;
        pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
        const pMat = new THREE.PointsMaterial({ size: 0.02, color: 0xffffff, opacity: 0.4, transparent:true });
        const particles = new THREE.Points(pGeo, pMat);
        scene.add(particles);

        camera.position.z = 6;
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();
            material.uniforms.time.value = t;
            core.rotation.y = t * 0.1;
            particles.rotation.y = t * 0.05;
            renderer.render(scene, camera);
        }
        animate();

        /* --- GMGN LOGIC --- */
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            // REMOVED AUTO-FILL to solve caching issue
        });

        let currentCA = "";

        async function runGMGNScan() {
            const ca = document.getElementById('ca-input').value.trim();
            if(!ca) return;
            localStorage.setItem('last_audit_ca', ca);
            currentCA = ca;

            gsap.to('#input-section', { opacity: 0, scale: 0.8, duration: 0.5, onComplete: () => document.getElementById('input-section').style.display = 'none' });
            document.getElementById('loading-text').style.display = 'block';
            gsap.to(material.uniforms.color.value, { r: 1, g: 1, b: 1, duration: 0.5 });
            gsap.to(material.uniforms.spike, { value: 0.5, duration: 0.5, yoyo: true, repeat: 3 });

            try {
                // PARALLEL FETCH: GoPlus + DexScreener
                const [gpRes, dexRes] = await Promise.all([
                    fetch(`https://api.gopluslabs.io/api/v1/solana/token_security?contract_addresses=${ca}`),
                    fetch(`https://api.dexscreener.com/latest/dex/tokens/${ca}`)
                ]);

                const gpJson = await gpRes.json();
                const dexJson = await dexRes.json();

                const secData = gpJson.result && gpJson.result[ca] ? gpJson.result[ca] : {};
                const pairData = dexJson.pairs && dexJson.pairs.length > 0 ? dexJson.pairs[0] : { liquidity: { usd: 0 }, baseToken: { symbol: "UNK" } };

                // --- GMGN CHECKS ---
                
                // 1. MINT CHECK
                const isMintable = secData.is_mintable === "1";
                
                // 2. FREEZE/BLACKLIST CHECK
                const isFreezable = secData.freezable && secData.freezable.status === "1";
                
                // 3. BURN CHECK
                let isBurned = false;
                const burnAddresses = ["1nc1nerator11111111111111111111111111111111", "Dead111111111111111111111111111111111111111"];
                if(secData.lp_holders) {
                    secData.lp_holders.forEach(h => {
                        if(burnAddresses.includes(h.address) && parseFloat(h.percent) > 0.8) isBurned = true;
                    });
                }

                // 4. TOP 10 HOLDERS
                const top10Safe = secData.holder_count > 50; // Simple heuristic

                // SCORING
                let score = 100;
                if(isMintable) score -= 40;
                if(isFreezable) score -= 30;
                if(!isBurned) score -= 30;
                if(pairData.liquidity.usd < 1000) score = 0;

                score = Math.max(0, score);

                // DATA OBJECT
                const result = {
                    score: score,
                    mint: isMintable ? "ENABLED (RISK)" : "DISABLED (SAFE)",
                    freeze: isFreezable ? "ENABLED (RISK)" : "DISABLED (SAFE)",
                    burn: isBurned ? "100% BURNED" : "UNLOCKED/LOW",
                    top10: top10Safe ? "DISTRIBUTED" : "CONCENTRATED",
                    verdict: score > 80 ? "GMGN SAFE" : (score > 40 ? "CAUTION" : "RUG DETECTED"),
                    sound: score <= 40,
                    symbol: pairData.baseToken.symbol || "TOKEN"
                };

                document.getElementById('loading-text').style.display = 'none';
                displayGMGNResults(result, ca);
                saveToHistory(ca, result);

            } catch(e) {
                console.error(e);
                alert("Scan Error: " + e.message);
                resetScanner();
            }
        }

        function displayGMGNResults(res, ca) {
            // Morph Core
            let color = { r:0, g:1, b:0.2 };
            let spike = 0.1;

            if(res.score < 50) {
                color = { r:1, g:0, b:0.2 }; spike = 0.9;
                if(res.sound) playAlarm();
            } else if (res.score < 80) {
                color = { r:1, g:0.8, b:0 }; spike = 0.4;
            }

            gsap.to(material.uniforms.color.value, { r: color.r, g: color.g, b: color.b, duration: 1.5 });
            gsap.to(material.uniforms.spike, { value: spike, duration: 1.5 });

            // Update HUD
            updateHud('val-mint', res.mint, res.mint.includes("SAFE"));
            updateHud('val-freeze', res.freeze, res.freeze.includes("SAFE"));
            updateHud('val-burn', res.burn, res.burn.includes("100%"));
            updateHud('val-top10', res.top10, res.top10 === "DISTRIBUTED");

            // Update Target Display
            document.getElementById('val-symbol').innerText = "$" + res.symbol;
            document.getElementById('val-ca').innerText = ca;
            document.getElementById('val-ca').style.color = `rgb(${color.r*255}, ${color.g*255}, ${color.b*255})`;

            const vText = document.getElementById('verdict-text');
            vText.innerText = res.verdict;
            vText.style.color = `rgb(${color.r*255}, ${color.g*255}, ${color.b*255})`;
            document.getElementById('score-sub').innerText = `TRUST SCORE: ${res.score}/100`;

            gsap.to('.hud-panel', { opacity: 1, duration: 0.5, stagger: 0.2 });
            gsap.to('#reset-btn', { opacity: 1, duration: 0.5, delay: 1 });
        }

        function updateHud(id, text, isSafe) {
            const el = document.getElementById(id);
            el.innerText = text;
            el.style.color = isSafe ? "var(--neon-green)" : "var(--neon-red)";
        }

        function copyCA() {
            navigator.clipboard.writeText(currentCA);
            alert("COPIED: " + currentCA);
        }

        function resetScanner() {
            gsap.to('.hud-panel', { opacity: 0, duration: 0.3 });
            gsap.to('#reset-btn', { opacity: 0, duration: 0.3 });
            gsap.to(material.uniforms.color.value, { r: 0.2, g: 0.2, b: 0.2, duration: 1 });
            gsap.to(material.uniforms.spike, { value: 0.1, duration: 1 });
            
            // Show and Clear Input
            const inputSec = document.getElementById('input-section');
            inputSec.style.display = 'block';
            gsap.to(inputSec, { opacity: 1, scale: 1, duration: 0.5, delay: 0.5 });
            
            document.getElementById('loading-text').style.display = 'none';
            const inputField = document.getElementById('ca-input');
            inputField.value = ''; // CLEAR INPUT
            inputField.focus(); // FOCUS INPUT
        }

        function toggleHistory() { document.getElementById('history-panel').classList.toggle('open'); }

        function saveToHistory(ca, res) {
            let hist = JSON.parse(localStorage.getItem('gmgn_hist') || '[]');
            hist = hist.filter(h => h.ca !== ca);
            let cssColor = res.score > 80 ? 'var(--neon-green)' : (res.score > 40 ? 'var(--neon-yellow)' : 'var(--neon-red)');
            hist.unshift({ ca, score: res.score, verdict: res.verdict, color: cssColor, symbol: res.symbol });
            if(hist.length > 20) hist.pop();
            localStorage.setItem('gmgn_hist', JSON.stringify(hist));
            loadHistory();
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            const hist = JSON.parse(localStorage.getItem('gmgn_hist') || '[]');
            list.innerHTML = "";
            hist.forEach(h => {
                const div = document.createElement('div');
                div.className = 'hist-item';
                div.innerHTML = `<div><div class="hist-ca" style="color:#fff; font-weight:bold;">$${h.symbol || "UNK"}</div><div class="hist-ca">${h.ca.slice(0,6)}...</div><div class="hist-verdict" style="color:${h.color}">${h.verdict}</div></div><div class="hist-score" style="color:${h.color}">${h.score}</div>`;
                div.onclick = () => { document.getElementById('ca-input').value = h.ca; toggleHistory(); runGMGNScan(); };
                list.appendChild(div);
            });
        }

        function clearHistory() { localStorage.removeItem('gmgn_hist'); loadHistory(); }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playAlarm() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 1);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime+1);
        }
    </script>
</body>
</html>